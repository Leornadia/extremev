"use strict";(()=>{var e={};e.id=9436,e.ids=[9436],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},61348:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>f,patchFetch:()=>O,requestAsyncStorage:()=>g,routeModule:()=>h,serverHooks:()=>x,staticGenerationAsyncStorage:()=>R});var r={};s.r(r),s.d(r,{POST:()=>w});var a=s(49303),o=s(88716),n=s(60670),i=s(87070),u=s(72331),d=s(98691),p=s(96543),l=s(84770),c=s.n(l);let m=p.Ryn({token:p.Z_8().min(1,"Token is required"),password:p.Z_8().min(8,"Password must be at least 8 characters").regex(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/,"Password must contain at least one uppercase letter, one lowercase letter, and one number")});async function w(e){try{let t=await e.json(),s=m.safeParse(t);if(!s.success)return i.NextResponse.json({error:{code:"VALIDATION_ERROR",message:"Invalid input",details:s.error.flatten().fieldErrors,timestamp:new Date().toISOString()}},{status:400});let{token:r,password:a}=s.data,o=c().createHash("sha256").update(r).digest("hex"),n=await u._.passwordResetToken.findUnique({where:{token:o}});if(!n)return i.NextResponse.json({error:{code:"INVALID_TOKEN",message:"Invalid or expired reset token",timestamp:new Date().toISOString()}},{status:400});if(n.expires<new Date)return await u._.passwordResetToken.delete({where:{id:n.id}}),i.NextResponse.json({error:{code:"TOKEN_EXPIRED",message:"Reset token has expired. Please request a new one.",timestamp:new Date().toISOString()}},{status:400});if(n.used)return i.NextResponse.json({error:{code:"TOKEN_USED",message:"This reset token has already been used",timestamp:new Date().toISOString()}},{status:400});let p=await u._.user.findUnique({where:{email:n.email}});if(!p)return i.NextResponse.json({error:{code:"USER_NOT_FOUND",message:"User not found",timestamp:new Date().toISOString()}},{status:404});let l=await d.ZP.hash(a,12);return await u._.$transaction([u._.user.update({where:{id:p.id},data:{passwordHash:l}}),u._.passwordResetToken.update({where:{id:n.id},data:{used:!0}})]),i.NextResponse.json({success:!0,message:"Password has been reset successfully. You can now sign in with your new password."},{status:200})}catch(e){return console.error("Reset password error:",e),i.NextResponse.json({error:{code:"INTERNAL_ERROR",message:"An error occurred resetting your password",timestamp:new Date().toISOString()}},{status:500})}}let h=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/auth/reset-password/route",pathname:"/api/auth/reset-password",filename:"route",bundlePath:"app/api/auth/reset-password/route"},resolvedPagePath:"/Users/almeidajose/Documents/A/App/Extreme V/app/api/auth/reset-password/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:g,staticGenerationAsyncStorage:R,serverHooks:x}=h,f="/api/auth/reset-password/route";function O(){return(0,n.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:R})}},72331:(e,t,s)=>{s.d(t,{Z:()=>i,_:()=>n});var r=s(53524);let a=global,o=null;try{o=a.prisma||new r.PrismaClient({log:["error"]})}catch(e){console.warn("Prisma client initialization failed:",e),o=null}let n=o,i=n}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[8948,5972,8691,6543],()=>s(61348));module.exports=r})();