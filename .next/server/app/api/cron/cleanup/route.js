"use strict";(()=>{var e={};e.id=1843,e.ids=[1843],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},73069:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>w,patchFetch:()=>h,requestAsyncStorage:()=>p,routeModule:()=>c,serverHooks:()=>m,staticGenerationAsyncStorage:()=>d});var n={};r.r(n),r.d(n,{GET:()=>l});var a=r(49303),o=r(88716),s=r(60670),i=r(87070),u=r(72331);async function l(e){if(e.headers.get("authorization")!==`Bearer ${process.env.CRON_SECRET}`)return i.NextResponse.json({error:"Unauthorized"},{status:401});try{let e=Date.now(),t={deletedTokens:0,deletedUnverifiedUsers:0,archivedQuotes:0},r=new Date(Date.now()-864e5);try{let e=await u._.$executeRaw`
        DELETE FROM "PasswordResetToken"
        WHERE "expiresAt" < ${r}
      `;t.deletedTokens=Number(e)}catch{console.log("No PasswordResetToken table found, skipping token cleanup")}let n=new Date(Date.now()-6048e5);try{let e=await u._.user.deleteMany({where:{emailVerified:null,createdAt:{lt:n}}});t.deletedUnverifiedUsers=e.count}catch(e){console.log("Error deleting unverified users:",e)}let a=new Date(Date.now()-7776e6);try{let e=await u._.quoteRequest.updateMany({where:{status:"pending",createdAt:{lt:a}},data:{status:"archived"}});t.archivedQuotes=e.count}catch(e){console.log("Error archiving quotes:",e)}let o=Date.now()-e;return console.log("Cleanup completed:",t),i.NextResponse.json({success:!0,timestamp:new Date().toISOString(),duration:`${o}ms`,results:t})}catch(e){return console.error("Cleanup job failed:",e),i.NextResponse.json({success:!1,timestamp:new Date().toISOString(),error:e instanceof Error?e.message:"Unknown error"},{status:500})}}let c=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/cron/cleanup/route",pathname:"/api/cron/cleanup",filename:"route",bundlePath:"app/api/cron/cleanup/route"},resolvedPagePath:"/Users/almeidajose/Documents/A/App/Extreme V/app/api/cron/cleanup/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:p,staticGenerationAsyncStorage:d,serverHooks:m}=c,w="/api/cron/cleanup/route";function h(){return(0,s.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:d})}},72331:(e,t,r)=>{r.d(t,{Z:()=>i,_:()=>s});var n=r(53524);let a=global,o=null;try{o=a.prisma||new n.PrismaClient({log:["error"]})}catch(e){console.warn("Prisma client initialization failed:",e),o=null}let s=o,i=s}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[8948,5972],()=>r(73069));module.exports=n})();